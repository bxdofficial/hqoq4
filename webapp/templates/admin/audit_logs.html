{% extends 'base.html' %}
{% block title %}سجل التدقيق{% endblock %}
{% block content %}
<section class="glass" style="padding:24px;margin-bottom:20px;">
  <h2>سجل التدقيق</h2>
  <form method="get" action="/admin/audit-logs" style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
    <input name="q" value="{{ q }}" placeholder="بحث باسم المنفذ أو نوع الحدث" style="flex:1;min-width:240px;"/>
    <select name="action">
      <option value="all">كل الإجراءات</option>
      {% for a in actions %}<option value="{{ a }}" {% if action == a %}selected{% endif %}>{{ a }}</option>{% endfor %}
    </select>
    <button class="btn" type="submit">فلترة</button>
  </form>
</section>

<section class="table-wrap glass">
  <table>
    <thead><tr><th>#</th><th>الإجراء</th><th>المنفذ</th><th>الهدف</th><th>وقت التنفيذ</th><th>Metadata</th></tr></thead>
    <tbody>
      {% for log in audit_logs %}
      <tr>
        <td>#{{ log.id }}</td>
        <td>{{ log.action }}</td>
        <td>{{ log.actor_name or ('User #' ~ log.actor_user_id if log.actor_user_id else 'System') }}</td>
        <td>{{ log.target_type or '-' }}{% if log.target_id %} #{{ log.target_id }}{% endif %}</td>
        <td>{{ log.created_at }}</td>
        <td><code style="font-size:12px;white-space:pre-wrap;">{{ log.metadata or '{}' }}</code></td>
      </tr>
      {% else %}
      <tr><td colspan="6" class="table-empty">لا توجد سجلات مطابقة.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}

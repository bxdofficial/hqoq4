{% extends 'base.html' %}
{% block title %}ุงูุจุญุซ ุนู ูุญุงูู | ุญูููู{% endblock %}

{% block content %}
<!-- Search Header -->
<section class="search-header glass fade-in">
  <h2>
    <i data-lucide="search" style="width:28px;height:28px;display:inline-block;vertical-align:middle;margin-left:12px;color:var(--gold)"></i>
    ุงุจุญุซ ุนู ูุญุงูู
  </h2>
  <p>ุงุฎุชุฑ ูุญุงููุงู ููุงุณุจุงู ูู ุจูู ุฃูุถู ุงููุญุงููู ุงูููุซููู ูู ูุตุฑ</p>
  
  <div class="search-box">
    <input type="text" id="search-input" placeholder="ุงุจุญุซ ุจุงูุงุณู ุฃู ุงูุชุฎุตุต ุฃู ุงูููุทูุฉ..." />
    <button class="btn btn-gold" onclick="filterLawyers()">
      <i data-lucide="search" style="width:18px;height:18px"></i>
      ุจุญุซ
    </button>
  </div>
  
  <div class="search-filters">
    <button class="filter-btn active" data-filter="all">ุงููู</button>
    <button class="filter-btn" data-filter="verified">ููุซู</button>
    <button class="filter-btn" data-filter="cairo">ุงููุงูุฑุฉ</button>
    <button class="filter-btn" data-filter="alex">ุงูุฅุณููุฏุฑูุฉ</button>
    <button class="filter-btn" data-filter="giza">ุงูุฌูุฒุฉ</button>
  </div>
</section>

<!-- Results Count -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 0 8px;">
  <p style="color: var(--text-secondary);">
    <i data-lucide="users" style="width:16px;height:16px;display:inline-block;vertical-align:middle;margin-left:6px"></i>
    <span id="results-count">{{ lawyers|length }}</span> ูุญุงูู ูุชุงุญ
  </p>
  <select id="sort-select" style="width: auto; padding: 8px 16px; font-size: 13px;">
    <option value="verified">ุงูุฃูุซุฑ ุชูุซููุงู</option>
    <option value="fee-low">ุงูุฃูู ุณุนุฑุงู</option>
    <option value="fee-high">ุงูุฃุนูู ุณุนุฑุงู</option>
    <option value="name">ุงูุงุณู</option>
  </select>
</div>

<!-- Lawyers Grid -->
<section class="grid3 stagger" id="lawyers-grid">
{% for l in lawyers %}
  <article class="glass card lawyer-card" data-name="{{ l.full_name }}" data-verified="{{ l.is_verified }}" data-city="{{ l.city or '' }}" data-governorate="{{ l.governorate or '' }}" data-fee="{{ l.min_consultation_fee or 400 }}">
    <div class="avatar">
      {{ l.full_name[0] if l.full_name else '?' }}
    </div>
    <h3>{{ l.full_name }}</h3>
    
    {% if l.is_verified %}
    <span class="badge badge-verified" style="margin-bottom: 12px;">
      <i data-lucide="badge-check" style="width:12px;height:12px"></i>
      ูุญุงูู ููุซู
    </span>
    {% else %}
    <span class="badge badge-warning" style="margin-bottom: 12px;">
      <i data-lucide="clock" style="width:12px;height:12px"></i>
      ููุฏ ุงูุชุญูู
    </span>
    {% endif %}
    
    <div class="info">
      <div class="info-item">
        <i data-lucide="badge" style="width:14px;height:14px"></i>
        ุฑูู ุงูููุฏ: {{ l.bar_registration_number or 'ุบูุฑ ูุชุงุญ' }}
      </div>
      <div class="info-item">
        <i data-lucide="map-pin" style="width:14px;height:14px"></i>
        {{ l.governorate or 'ูุตุฑ' }}{% if l.city %} / {{ l.city }}{% endif %}
      </div>
    </div>
    
    <div class="fee">
      <i data-lucide="banknote" style="width:18px;height:18px;display:inline-block;vertical-align:middle;margin-left:6px"></i>
      ูุจุฏุฃ ูู {{ l.min_consultation_fee or 400 }} ุฌ.ู
    </div>
    
    <div style="display: flex; gap: 8px; justify-content: center;">
      <a href="/lawyers/{{ l.id }}" class="btn btn-sm">
        <i data-lucide="user" style="width:14px;height:14px"></i>
        ุงูููู ุงูุดุฎุตู
      </a>
      {% if user %}
      <a href="/cases/new?lawyer_id={{ l.id }}" class="btn btn-sm btn-gold">
        <i data-lucide="plus" style="width:14px;height:14px"></i>
        ุทูุจ ุงุณุชุดุงุฑุฉ
      </a>
      {% endif %}
    </div>
  </article>
{% else %}
  <div class="glass empty-state" style="grid-column: 1 / -1;">
    <div class="icon">๐ฅ</div>
    <h3>ูุง ููุฌุฏ ูุญุงููู ุญุงููุงู</h3>
    <p>ุณูุชู ุฅุถุงูุฉ ูุญุงููู ูุฑูุจุงูุ ููููู ุงูุชุณุฌูู ููุญุงูู</p>
    <a href="/register" class="btn btn-gold">
      <i data-lucide="user-plus" style="width:18px;height:18px"></i>
      ุณุฌูู ููุญุงูู
    </a>
  </div>
{% endfor %}
</section>
{% endblock %}

{% block scripts %}
<script>
  // Filter functionality
  const searchInput = document.getElementById('search-input');
  const lawyersGrid = document.getElementById('lawyers-grid');
  const resultsCount = document.getElementById('results-count');
  const filterBtns = document.querySelectorAll('.filter-btn');
  
  let currentFilter = 'all';
  
  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      filterBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentFilter = btn.dataset.filter;
      filterLawyers();
    });
  });
  
  function filterLawyers() {
    const searchTerm = searchInput.value.toLowerCase();
    const cards = lawyersGrid.querySelectorAll('.lawyer-card');
    let visibleCount = 0;
    
    cards.forEach(card => {
      const name = card.dataset.name.toLowerCase();
      const city = card.dataset.city.toLowerCase();
      const governorate = card.dataset.governorate.toLowerCase();
      const isVerified = card.dataset.verified === '1';
      
      let matchesSearch = name.includes(searchTerm) || city.includes(searchTerm) || governorate.includes(searchTerm);
      let matchesFilter = true;
      
      if (currentFilter === 'verified') {
        matchesFilter = isVerified;
      } else if (currentFilter === 'cairo') {
        matchesFilter = governorate.includes('ูุงูุฑุฉ') || governorate.includes('cairo');
      } else if (currentFilter === 'alex') {
        matchesFilter = governorate.includes('ุฅุณููุฏุฑูุฉ') || governorate.includes('alexandria');
      } else if (currentFilter === 'giza') {
        matchesFilter = governorate.includes('ุฌูุฒุฉ') || governorate.includes('giza');
      }
      
      if (matchesSearch && matchesFilter) {
        card.style.display = '';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });
    
    resultsCount.textContent = visibleCount;
  }
  
  searchInput.addEventListener('input', filterLawyers);
  
  // Sort functionality
  document.getElementById('sort-select').addEventListener('change', function() {
    const cards = Array.from(lawyersGrid.querySelectorAll('.lawyer-card'));
    
    cards.sort((a, b) => {
      switch(this.value) {
        case 'verified':
          return (b.dataset.verified === '1' ? 1 : 0) - (a.dataset.verified === '1' ? 1 : 0);
        case 'fee-low':
          return parseInt(a.dataset.fee) - parseInt(b.dataset.fee);
        case 'fee-high':
          return parseInt(b.dataset.fee) - parseInt(a.dataset.fee);
        case 'name':
          return a.dataset.name.localeCompare(b.dataset.name, 'ar');
        default:
          return 0;
      }
    });
    
    cards.forEach(card => lawyersGrid.appendChild(card));
  });
</script>
{% endblock %}
